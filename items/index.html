{% extends "layouts/layout.html" %}
{% block title %}
Items
{% endblock %}
{% block content %}
<h3>All Items</h3>
<hr />
<script type="text/javascript" src="/js/items/items.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    var items = [];{% for item in items %} items = items.concat("{{item.title}}"); {% endfor %}
    $('#advanced_search').autocomplete({
      source: items
    });



    $(".remote_search_table").each(function(index, item){
      $(item).append("<h4>Loading...</h4>");
      var url = $(item).attr("data-api-url");
      $(item).find("tbody").html("");
      console.log(url);
      $.get("/webservices/search", { "limit" : 10, "offset" : 0, "search_by" : "title", "query" : "item" }, function(resp){
        resp = JSON.parse(resp);
        $(item).find("h4").remove();
        $tbody = $(item).find("tbody");
        for(var i = 0; i < resp.items.length; i++){
          var it = resp.items[i];
          $tbody.append("<tr><td>" + "1/1/1" + "</td><td>" + it.title + "</td><td>" + it.description + "</td><td>" + it.price + "</td></tr>");
        }
      });
    });

  });
</script>

<form action="/items/search" method="get">
  <div class="well ui-widget">Advanced Search: 
    <input type="text" id="advanced_search" name="query"/><br/>
    <button type="submit" value="Search" class="btn">Search</button>
    {% if user %}
      <p><br/><a href="/items/old_searches">View Old Searches</a></p>
    {% endif %}
  </div>
</form>

<div class="remote_search_table_wrapper">
<table class="table table-striped remote_search_table" data-api-url="localhost:8081">
  <thead>
    <th width="10%">Posted</th><th>Title</th><th>Description</th><th>Price</th>
  </thead>
  <tbody>
    <tr>
      <td>a</td>
      <td>b</td>
      <td>c</td>
      <td>d</td>
    </tr>
  </tbody>
</table>
</div>

<br/><br/>
<table class="datatable table table-striped">
	<thead>
		<tr>
      <th width="10%">Posted</th><th>Title</th><th>Description</th><th>Price</th>
			{% if is_admin %}
			<th>Delete</th><th width="15%">Expiration Date</th>
			{% endif %}
      {% if user %}
        <th>Contact</th>
      {% endif %}
		</tr>
	</thead>
	<tbody>
		{% for item in items %}
		<tr>
      <td>
        <div>{{item.created_at.strftime("%m/%d/%Y")}}</div>
      </td>
			<td>
				<a href="/items/view_item?item_id={{ item.key().id() }}">
					<div>{{ item.title }}</div>
				</a>
			</td>
			<td>{% if item.summary %} {{ item.summary }} {% else %} {{ item.description }} {% endif %}</td>
			<td>${{ item.price }}</td>
			{% if is_admin %}
			<td>
				<a href="/items/delete_item?item_id={{ item.key().id() }}&xsrf_token={{xsrf_token}}">
					<button class="btn btn-primary"  value="Delete">Delete Item</button> 
				</a>
			</td>
      <td>{{item.expiration_date.strftime("%m/%d/%Y")}}</td>
			{% endif %}
      {% if user %}
        <td>
          <a href="/threads/new_thread?about={{ item.key().id() }}">
            <button class="btn btn-primary" value="Contact Seller">Contact Seller</button> 
          </a>
        </td>
      {% endif %}
		</tr>
		{% endfor %}
	</tbody>
</table>
<br/>
<br />
{% if user %}
<p><a class="btn" href="/items/new_item">New Item</a></p>
{% endif %}

{% endblock %}
