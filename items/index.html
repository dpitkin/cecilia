{% extends "layouts/layout.html" %}
{% block title %}
My Items
{% endblock %}
{% block content %}
<h3>All Items</h3>
<hr />
<script type="text/javascript">
  $(document).ready(function() {
    var items = [];{% for item in items %} items = items.concat("{{item.title}}"); {% endfor %}
    $('#advanced_search').autocomplete({
      source: items
    });
  });
</script>

<form action="/items/search" method="get">
  <div class="well ui-widget">Advanced Search: 
    <input type="text" id="advanced_search" name="query"/><br/>
    <button type="submit" value="Search" class="btn">Search</button>
    {% if user %}
      <p><br/><a href="/items/old_searches">View Old Searches</a></p>
    {% endif %}
  </div>
</form>

<br/><br/>
<table class="datatable table table-striped">
	<thead>
		<tr>
      <th width="10%">Posted</th><th>Title</th><th>Description</th><th>Price</th>
			{% if is_admin %}
			<th>Delete</th><th width="15%">Expiration Date</th>
			{% endif %}
      {% if user %}
        <th>Contact</th>
      {% endif %}
		</tr>
	</thead>
	<tbody>
		{% for item in items %}
		<tr>
      <td>
        <div>{{item.created_at.strftime("%m/%d/%Y")}}</div>
      </td>
			<td>
				<a href="/items/view_item?item_id={{ item.key().id() }}">
					<div>{{ item.title }}</div>
				</a>
			</td>
			<td>{% if item.summary %} {{ item.summary }} {% else %} {{ item.description }} {% endif %}</td>
			<td>${{ item.price }}</td>
			{% if is_admin %}
			<td>
				<a href="/items/delete_item?item_id={{ item.key().id() }}&xsrf_token={{current_li.xsrf_token}}">
					<button class="btn btn-primary"  value="Delete">Delete Item</button> 
				</a>
			</td>
      <td>{{item.expiration_date.strftime("%m/%d/%Y")}}</td>
			{% endif %}
      {% if user %}
        <td>
          <a href="/threads/new_thread?about={{ item.key().id() }}">
            <button class="btn btn-primary" value="Contact Seller">Contact Seller</button> 
          </a>
        </td>
      {% endif %}
		</tr>
		{% endfor %}
	</tbody>
</table>
<br/>
<br />
{% if user %}
<p><a class="btn" href="/items/new_item">New Item</a></p>
{% endif %}

{% endblock %}
